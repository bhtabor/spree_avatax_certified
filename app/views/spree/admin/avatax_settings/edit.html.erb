<% origin = JSON.parse(Spree::Config.avatax_origin) || {} %>
<h1><%= t('avatax_settings') %></h1>

<%= form_tag(admin_avatax_settings_path, method: :put, id: :avatax_settings_form) do %>

<div class="yui-g">
  <div class="yui-u first">
    <fieldset>
      <legend><%= t('avatax_api_login_and_key') %></legend>
      <p>
        <label><%= t('avatax_company_code') %></label><br />
        <%= text_field_tag('settings[avatax_company_code]', Spree::Config.avatax_company_code, maxlength: 256, class: 'avatax') %>
      </p>

      <p>
        <label><%= t('avatax_account') %></label><br />
        <%= text_field_tag('settings[avatax_account]', Spree::Config.avatax_account, maxlength: 256, class: 'avatax') %>
      </p>
      <p>
        <label><%= t('avatax_license_key') %></label><br />
        <%= text_field_tag('settings[avatax_license_key]', Spree::Config.avatax_license_key, maxlength: 256, class: 'avatax') %>
      </p>
    </fieldset>

    <fieldset>
      <legend><%= t('avatax_endpoint_urls') %></legend>
      <p>
        <label><%= t('avatax_endpoint') %></label><br />
        <%= text_field_tag('settings[avatax_endpoint]', Spree::Config.avatax_endpoint, size: 46, maxlength: 256, class: 'avatax') %>
      </p>
      <p>
        <label><%= t('avatax_servicepath_tax') %></label><br />
        <input type="text" placeholder="<%= AVATAX_SERVICEPATH_TAX %>", readonly>
      </p>
      <p>
        <label><%= t('avatax_servicepath_address') %></label><br />
        <input type="text" placeholder="<%= AVATAX_SERVICEPATH_ADDRESS %>", readonly>
      </p>
      <p>
        <label><%= t('avatax_client_version') %></label><br />
        <input type="text" placeholder="<%= AVATAX_CLIENT_VERSION %>", readonly>
      </p>
    </fieldset>

    <fieldset>
      <legend><%= t('avatax_log') %></legend>
      <p>
        <label><%= t('log_to_file') %></label><br />
        <%= check_box_tag('settings[avatax_log]', true, Spree::Config.avatax_log, class: 'avatax') %>
      </p>

      <p>
        <label><%= t('log_to_stdout') %></label><br />
        <%= check_box_tag('settings[avatax_log_to_stdout]', true, Spree::Config.avatax_log_to_stdout, class: 'avatax') %>
      </p>
    </fieldset>

    <fieldset>
      <legend><%= t('avatax_raise_exceptions') %></legend>
      <p>
        <label><%= t('enable_avatax_raise_exceptions') %></label><br />
        <%= check_box_tag('settings[avatax_raise_exceptions]', true, Spree::Config.avatax_raise_exceptions, class: 'avatax') %>
      </p>
    </fieldset>

    <fieldset>
      <legend><%= t('avatax_address_validation') %></legend>
      <p>
        <label><%= t('enable_avatax_address_validation') %></label><br />
        <%= check_box_tag('settings[avatax_address_validation]', true, Spree::Config.avatax_address_validation, class: 'avatax') %>
      </p>
    </fieldset>
    <fieldset>
      <legend><%= t('avatax_refuse_checkout_address_validation_error') %></legend>
      <p>
        <label><%= t('enable_avatax_refuse_checkout_address_validation_error') %></label><br />
        <%= check_box_tag('settings[avatax_refuse_checkout_address_validation_error]', true, Spree::Config.avatax_refuse_checkout_address_validation_error, class: 'avatax') %>
      </p>
    </fieldset>
    <fieldset>
      <legend><%= t('avatax_customer_can_validate') %></legend>
      <p>
        <label><%= t('enable_avatax_customer_can_validate') %></label><br />
        <%= check_box_tag('settings[avatax_customer_can_validate]', true, Spree::Config.avatax_customer_can_validate, class: 'avatax') %>
      </p>
    </fieldset>
    <fieldset>
      <legend><%= t('avatax_address_validation_enabled_countries') %></legend>
      <p>
        <% current_countries = Spree::Country.where(name: Spree::Config.avatax_address_validation_enabled_countries) %>
        <label><%= t('enable_avatax_address_validation_for_these_countries') %></label><br />
        <%= select_tag('settings[avatax_address_validation_enabled_countries]', options_from_collection_for_select(Spree::Country.all, "name", "name", selected: current_countries), multiple: true, class: "select2 fullwidth") %>
      </p>
    </fieldset>
    <fieldset>
      <legend><%= t('avatax_tax_calculation') %></legend>
      <p>
        <label><%= t('enable_avatax_tax_calculation') %></label><br />
        <%= check_box_tag('settings[avatax_tax_calculation]', true, Spree::Config.avatax_tax_calculation, class: 'avatax') %>
      </p>
    </fieldset>

        <fieldset>
      <legend><%= t('avatax_document_committing') %></legend>
      <p>
        <label><%= t('enable_avatax_document_committing') %></label><br />
        <%= check_box_tag('settings[avatax_document_commit]', true, Spree::Config.avatax_tax_calculation, class: 'avatax') %>
      </p>
    </fieldset>

    <fieldset>
      <legend><%= t('business_address') %></legend>
      <p>
        <label><%= Spree.t('address1') %></label><br />
        <%= text_field_tag('address[avatax_address1]', origin["line1"], size: 46, maxlength: 256, class: 'avatax') %>
      </p>
      <p>
        <label><%= Spree.t('address2') %></label><br />
        <%= text_field_tag('address[avatax_address2]', origin["line2"], size: 46, maxlength: 256, class: 'avatax') %>
      </p>
      <p>
        <label><%= Spree.t('city') %></label><br />
        <%= text_field_tag('address[avatax_city]', origin["city"], size: 46, maxlength: 256, class: 'avatax') %>
      </p>
      <p>
        <label><%= Spree.t('state') %></label><br />
        <%= text_field_tag('address[avatax_region]', origin["region"], size: 46, maxlength: 256, class: 'avatax') %>
      </p>
      <p>
        <label><%= Spree.t('zipcode') %></label><br />
        <%= text_field_tag('address[avatax_zipcode]', origin["postalCode"], size: 46, maxlength: 256, class: 'avatax') %>
      </p>
      <p>
        <label><%= t('country_code') %></label><br />
        <span id="<%= "scountry-selection" %>" class="d-block position-relative">
          <% curr_country = Spree::Country.find_by(iso: origin["country"]) ||  Spree::Country.find_by(iso: 'US') %>
        <span id="scountry">
          <%= select_tag 'address[avatax_country]', options_from_collection_for_select(available_countries, 'iso', 'name', curr_country.try(:iso)), {:class => 'select2 avatax', id: 'country'} %>
        </span>
      </p>

    </fieldset>
    <fieldset>
    <legend><%= t('log_files') %></legend>
    <p>Log files are located in the log directory of your spree website.</p>
    <table>
    <tr>
   <td>
    <table>
      <tr>
        <td>avatax.log</td>
        <td><%= link_to("Download", { controller: :avatax_settings, action: :download_avatax_log }) %>
        </td>
        <td>
          <%= link_to("Clear Data", { controller: :avatax_settings, action: :erase_data, remote: true }) %>
        </td>
      </tr>
    </table>
  </td>
</tr>
</table>
</fieldset>
  </div>
</div>

<p class="form-buttons"><%= button t('save_preferences') %></p>

<% end %>
